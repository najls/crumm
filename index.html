<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>TP</title>

    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>

    <style>
        :root {
            --gap: 1rem;
        }

        body {
            background-color: black;
            color: white;
            display: flex;
            flex-direction: column;
            margin: 0;
            min-height: 100vh;
        }

        header { padding: var(--gap); }

        main {
            display: flex;
            flex: 1;
            flex-direction: column;
            padding: var(--gap);
        }

        body, main { gap: var(--gap); }

        #card {
            background-color: blueviolet;
            border: var(--gap) solid white;
            border-radius: 1.5rem;
            flex: 1;
        }

        .inactive { display: none; }
    </style>
</head>
<body>
    <main>
        <button id="renderReader">Scan code</button>
        <div class="inactive" id="reader"></div>
        <div id="card">?</div>
    </main>
    <script>
        // https://github.com/mebjas/html5-qrcode/
        var config = {
            fps: 10,
            qrbox: { width: 250, height: 250 },
            rememberLastUsedCamera: true,
            supportedScanTypes: [Html5QrcodeScanType.SCAN_TYPE_CAMERA]
        };

        var html5QrcodeScanner = undefined;
        var readerContainer = document.getElementById('reader');

        var categoryMap = new Map();

        // var foo = JSON.parse('https://najls.github.io/symmetrical-octo-robot/sega.json');
        // console.log(foo.questions);

        loadQuestion()

        document.getElementById('renderReader').addEventListener('click', async function() {
            readerContainer.classList.toggle('inactive');

            if (readerContainer.classList.contains('inactive')) {
                html5QrcodeScanner.clear();
            }
            else {
                html5QrcodeScanner = new Html5QrcodeScanner("reader", config, false);
                html5QrcodeScanner.render(onScanSuccess, onScanFailure);
            }
        });

        function onScanSuccess(decodedText, decodedResult) {
            html5QrcodeScanner.clear();
            readerContainer.classList.add('inactive');
        }

        function onScanFailure(error) {
            // handle scan failure, usually better to ignore and keep scanning.
        }

        async function loadQuestion() {
            const response = await fetch('https://najls.github.io/symmetrical-octo-robot/sega.json');
            const json = await response.json();

            console.log(json['id']);

            console.log(json['questions'][Math.floor(Math.random() * json.questions.length)]['question']);
        }
    </script>
</body>
</html>
